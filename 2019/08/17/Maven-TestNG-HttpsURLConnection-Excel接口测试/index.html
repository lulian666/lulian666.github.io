<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="接口测试,">










<meta name="description" content="1、分析业务接口 一般我们都是把excel表格的设计放在第一个，但我认为先分析好你要测的接口，提前确定好你需要的数据是什么，得到的数据是什么，然后你才能设计相应的框架，并思考技术选型。 经过分析，我选用Java的HttpsURLConnection库，新建一个请求类，请求方法有get和post两种，get请求的参数放在url后面，post请求参数以json格式放在body中。 所以excel作为数">
<meta name="keywords" content="接口测试">
<meta property="og:type" content="article">
<meta property="og:title" content="Maven + TestNG + HttpsURLConnection + Excel接口测试">
<meta property="og:url" content="http://yoursite.com/2019/08/17/Maven-TestNG-HttpsURLConnection-Excel接口测试/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1、分析业务接口 一般我们都是把excel表格的设计放在第一个，但我认为先分析好你要测的接口，提前确定好你需要的数据是什么，得到的数据是什么，然后你才能设计相应的框架，并思考技术选型。 经过分析，我选用Java的HttpsURLConnection库，新建一个请求类，请求方法有get和post两种，get请求的参数放在url后面，post请求参数以json格式放在body中。 所以excel作为数">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-08-26T08:44:03.501Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Maven + TestNG + HttpsURLConnection + Excel接口测试">
<meta name="twitter:description" content="1、分析业务接口 一般我们都是把excel表格的设计放在第一个，但我认为先分析好你要测的接口，提前确定好你需要的数据是什么，得到的数据是什么，然后你才能设计相应的框架，并思考技术选型。 经过分析，我选用Java的HttpsURLConnection库，新建一个请求类，请求方法有get和post两种，get请求的参数放在url后面，post请求参数以json格式放在body中。 所以excel作为数">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/08/17/Maven-TestNG-HttpsURLConnection-Excel接口测试/">





  <title>Maven + TestNG + HttpsURLConnection + Excel接口测试 | Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/17/Maven-TestNG-HttpsURLConnection-Excel接口测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Maven + TestNG + HttpsURLConnection + Excel接口测试</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-17T20:48:44+08:00">
                2019-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="1、分析业务接口"><a href="#1、分析业务接口" class="headerlink" title="1、分析业务接口"></a>1、分析业务接口</h2><ol>
<li>一般我们都是把excel表格的设计放在第一个，但我认为先分析好你要测的接口，提前确定好你需要的数据是什么，得到的数据是什么，然后你才能设计相应的框架，并思考技术选型。</li>
<li>经过分析，我选用Java的HttpsURLConnection库，新建一个请求类，请求方法有get和post两种，get请求的参数放在url后面，post请求参数以json格式放在body中。</li>
<li>所以excel作为数据源中需要告诉我用例名称、请求方法、参数的key和value、请求预期的状态码，请求结果中需要检查的值。</li>
<li>下一步就是确定用什么方法读取excel表格，我选的是jxl这个库，它的一个特点是只能读取.xls格式的表格，所以我们的数据源也要保存成这个格式。</li>
<li>那么读取完数据以后，要把它适当加工成程序更容易理解的格式，这样方便直接用。所以可以设计一个测试数据的类，把每一条测试用例都抽象成一个对象，每次用到数据都是实例化这个类。</li>
<li>有了测试数据类和请求类，还差检验结果了。请求的类中可以得到请求的结果，并且对结果进行处理获得状态码和结果body，需要校验的值可以从测试数据类中拿，再去进行对比。</li>
<li>这样分析下来，我们需要另一个类，他做的事情就是实例化请求类，用我们写的工具读取excel中的数据，并且把数据给到测试数据类，得到一个测试数据对象，然后对比结果。那么这个类每次测一条用例的时候都要重复做一些动作，比如取数据、对比数据，很像before test和after test的概念，所以这里我选用了TestNG框架。</li>
<li>那么我们的项目大概分为几个部分：请求类、测试数据类、发请求的类、各种工具类。这里就很方便去用maven作为一个管理工具</li>
</ol>
<p><strong>当然，这里只是简单分析思路，后面具体操作的时候，还是会有很多需要思考的细节。</strong></p>
<h2 id="2、设计excel表格"><a href="#2、设计excel表格" class="headerlink" title="2、设计excel表格"></a>2、设计excel表格</h2><p>根据上面的分析，我设计的表格的表头有：「Test No.」「enabled」「Testname」「Method」「description」「Protocol」「requestMethod」「Address」「code」「CheckPoint1」「CheckValue1」「CheckPoint2」「CheckValue2」「Key1」「Value1」「Key2」「Value2」「Key3」「Value3」「Key4」「Value4」「Key5」「Value5」</p>
<p>Test No.是序号，给自己看的，enabled表示要不要执行这条用例，这是后来在实践中发现需要这样的开关才加上的，Testname、Method和description是到时候写在测试报告里面当作日志。CheckPoint和CheckValue需要多少个是根据实际需求来的，可以无限扩展。value和key如果是在get方法里，那就用于url后的请求参数，如果是post，就是body中的参数，同样支持无限扩展。我的表格一开始也不是这样的，在实践的过程中慢慢的优化，最后稳定在这样的格式。</p>
<h2 id="3、添加依赖"><a href="#3、添加依赖" class="headerlink" title="3、添加依赖"></a>3、添加依赖</h2><p>Maven项目中添加依赖只需要在它的pom.xml文件中添加就可以，最终我的文件是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;apitest2&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;apitest2&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">&lt;name&gt;apitest2&lt;/name&gt;</span><br><span class="line">&lt;url&gt;http://maven.apache.org&lt;/url&gt;</span><br><span class="line"></span><br><span class="line">&lt;properties&gt;</span><br><span class="line">&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.8.1&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;httpclient&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.5.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt; </span><br><span class="line">    </span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.apache.httpcomponents/httpcore --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;httpcore&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.4.4&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.testng/testng --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.testng&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;testng&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;6.8.8&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.58&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/com.jayway.jsonpath/json-path --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.jayway.jsonpath&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;json-path&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/net.sourceforge.jexcelapi/jxl --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;net.sourceforge.jexcelapi&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;jxl&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.6.12&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p>在<a href="https://mvnrepository.com" target="_blank" rel="noopener">https://mvnrepository.com</a> 中搜索你需要用的库，比如testng，选一个版本号，一般用稳定版本，然后详情页中maven栏下的代码复制到你pom.xml中的dependencies标签中，等待项目自己下载好这个库，就可以使用了。</p>
<h2 id="4、工程结构"><a href="#4、工程结构" class="headerlink" title="4、工程结构"></a>4、工程结构</h2><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>配置文件和表格等都放在resource文件夹中，配置文件主要包含了host、excel的文件位置、请求所需要的header信息</p>
<h4 id="src-main-java"><a href="#src-main-java" class="headerlink" title="src/main/java"></a>src/main/java</h4><p>src/main/java里有三个包：test.com.api、test.com.request、test.com.utils和com.test.testdata，分别放了测试类、请求类、工具类和测试数据类</p>
<h5 id="test-com-api包"><a href="#test-com-api包" class="headerlink" title="test.com.api包"></a>test.com.api包</h5><p>包下包含2个类，TestApi是所有测试类的基类，它的的作用是读取配置文件中的token信息，如果没有的话就调用registerToken方法写进去，如果有就去更新一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">public class TestApi &#123;</span><br><span class="line">    protected Properties prop;</span><br><span class="line">    protected String excelPath;</span><br><span class="line">    protected String host; </span><br><span class="line">    protected String url;</span><br><span class="line">    protected JSONObject responseBody;</span><br><span class="line">    protected int responseCode;</span><br><span class="line">    protected String accessToken = &quot;&quot;;</span><br><span class="line">    protected String refreshToken = &quot;&quot;;</span><br><span class="line">    protected Map&lt;String, String&gt; tokenHeader;</span><br><span class="line"></span><br><span class="line">    @BeforeTest</span><br><span class="line">    public void setAccessToken() throws Exception&#123;</span><br><span class="line">        //先去读一下token文件看有没有</span><br><span class="line">        readTokenFile();</span><br><span class="line">        if(TextUtils.isEmpty(accessToken)) &#123;</span><br><span class="line">            //如果文件里没有内容，就获取2个token写进去</span><br><span class="line">            GetToken.registerToken(host);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            //文件里面有内容，要去用旧的token获取新的</span><br><span class="line">            GetToken.refreshToken(host, accessToken, refreshToken);</span><br><span class="line">            //换完了以后再更新一下TestApi这里的</span><br><span class="line">            readTokenFile();</span><br><span class="line">            tokenHeader = new HashMap&lt;String, String&gt;();</span><br><span class="line">            tokenHeader.put(&quot;x-jike-access-token&quot;, accessToken);</span><br><span class="line">            tokenHeader.put(&quot;x-jike-refresh-token&quot;, refreshToken);  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void readTokenFile() &#123;</span><br><span class="line">        try (FileReader reader = new FileReader(System.getProperty(&quot;user.dir&quot;) + &quot;/src/main/resource/x-jike-access-token.txt&quot;); </span><br><span class="line">        BufferedReader br = new BufferedReader(reader)) &#123;</span><br><span class="line">            //建议这里就读2行，分别赋值</span><br><span class="line">            accessToken = br.readLine();</span><br><span class="line">            if (!TextUtils.isEmpty(accessToken)) &#123;</span><br><span class="line">                refreshToken = br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //构造函数</span><br><span class="line">    public TestApi() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //数据流的形式读取配置文件</span><br><span class="line">            prop = new Properties();</span><br><span class="line">            FileInputStream fis = new FileInputStream(System.getProperty(&quot;user.dir&quot;) + &quot;/src/main/resource/config.properties&quot;);</span><br><span class="line">            prop.load(fis);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    host = prop.getProperty(&quot;Host&quot;);</span><br><span class="line">    excelPath = prop.getProperty(&quot;testData&quot;);   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一个类是单接口测试的类，继承了TestApi类，它会实例化请求类和测试数据类，实现发送请求和获取响应结果的功能，代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">public class TraverseCases extends TestApi&#123;</span><br><span class="line">    Object[][] excelData;</span><br><span class="line">    TestData testData;</span><br><span class="line">    HttpRequest request;    </span><br><span class="line">    int codeExpected;</span><br><span class="line">    List&lt;NameValuePair&gt; bodyParams;</span><br><span class="line">    List&lt;TestData&gt; testDatas;</span><br><span class="line">    List&lt;NameValuePair&gt; checkPoints;</span><br><span class="line"></span><br><span class="line">    @BeforeClass()</span><br><span class="line">    public void setUp() throws Exception &#123;</span><br><span class="line">        //读取excel</span><br><span class="line">        excelData = ExcelProcess.processExcel(excelPath);</span><br><span class="line">        //实例化请求类</span><br><span class="line">        request = new  HttpRequest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DataProvider(name=&quot;testData&quot;)</span><br><span class="line">    private Iterator&lt;Object[]&gt; testDataProvider() throws IOException &#123;</span><br><span class="line">        List&lt;Object[]&gt; result= new ArrayList&lt;Object[]&gt;();</span><br><span class="line">        List&lt;TestData&gt; alldata = new ArrayList&lt;TestData&gt;();</span><br><span class="line">        TestData td = null;</span><br><span class="line">        for(int i = 1; i &lt; excelData.length; i++) &#123;</span><br><span class="line">            //防止Excel里面有空行</span><br><span class="line">            if(excelData[i][0] == null) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            //实例化测试数据</span><br><span class="line">            td = new TestData(i, excelData);</span><br><span class="line">            if(td.isEnabled()) &#123;</span><br><span class="line">                alldata.add(td);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Iterator it = alldata.iterator();</span><br><span class="line">        while(it.hasNext())&#123;</span><br><span class="line">            result.add(new Object[] &#123; it.next() &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        return  result.iterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test(dataProvider = &quot;testData&quot;)</span><br><span class="line">    public void testDifferentCases(TestData testData) throws IOException &#123;</span><br><span class="line">        //传入的参数就是每一条测试数据</span><br><span class="line">        if (testData != null) &#123;</span><br><span class="line">            LogUtil.info(&quot;Testcase description:&quot; + testData.getTestDescription());</span><br><span class="line">            bodyParams = testData.getKeys();</span><br><span class="line">            url = host + testData.getAddress();</span><br><span class="line">            LogUtil.info(&quot;Request url:&quot; + url);</span><br><span class="line">            String body = &quot;&quot;;</span><br><span class="line">            if(!bodyParams.isEmpty())&#123;</span><br><span class="line">                body = TurnListToString.turnBodyToString(bodyParams);</span><br><span class="line">            &#125;</span><br><span class="line">            //这里去要区分get还是post</span><br><span class="line">            //有个需要说明的，在表格里面如果是get方法，那么key和value代表params，如果是post，那它们就代表body里面的东西</span><br><span class="line">            String requestMethod = testData.getRequestMethod();</span><br><span class="line">            if(requestMethod.equals(&quot;post&quot;))  &#123;</span><br><span class="line">                request.sendPostRequest(url, body, tokenHeader);</span><br><span class="line">LogUtil.info(&quot;Request body:&quot; + body);</span><br><span class="line">            &#125;else if(requestMethod.equals(&quot;get&quot;)) &#123;</span><br><span class="line">                request.sendGetRequest(url, bodyParams, tokenHeader);</span><br><span class="line">                LogUtil.info(&quot;Request params:&quot; + body);</span><br><span class="line">            &#125;</span><br><span class="line">            //verify</span><br><span class="line">            responseCode = request.getResponseCode();</span><br><span class="line">            LogUtil.info(&quot;ResponseCode:&quot; + responseCode);</span><br><span class="line">            codeExpected = testData.getCodeExpected();</span><br><span class="line">            assertEquals(responseCode, codeExpected);</span><br><span class="line">            String checkPoint = &quot;&quot;;</span><br><span class="line">            checkPoints = testData.getCheckPoints();</span><br><span class="line"></span><br><span class="line">            for (NameValuePair pair : checkPoints) &#123;</span><br><span class="line">                checkPoint = pair.getName();</span><br><span class="line">                //如果检查点为空就不检查了</span><br><span class="line">                if(!TextUtils.isEmpty(checkPoint)) &#123;</span><br><span class="line">                    String checkValue = pair.getValue();</span><br><span class="line">                    String result = request.getStringFromResponseJSON(checkPoint, checkValue.length());</span><br><span class="line">                    LogUtil.info(&quot;CheckPoint:&quot; + checkPoint);</span><br><span class="line">                    LogUtil.info(&quot;CheckValue:&quot; + checkValue);</span><br><span class="line">                    LogUtil.info(&quot;ValueResult:&quot; + result);</span><br><span class="line">                    assertEquals(result, checkValue);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面涉及到TestNG的东西，这里就不叙述了，TestNG的用法可以见我的另一偏文章：<a href="https://lulian666.github.io/2019/08/04/TestNG/" target="_blank" rel="noopener">TestNG</a>。（所有非java提供的类和方法，都是自己写的工具类，具体就不贴出来了）。如果后面要写多接口的测试，也可以用testng中的depend或者dataprovider注释来设计先后的逻辑。</p>
<h5 id="test-com-request包"><a href="#test-com-request包" class="headerlink" title="test.com.request包"></a>test.com.request包</h5><p>这个包下只有一个类HttpRequest，这个类里最主要的两个方法是sendGetRequest和sendPostRequest，分别用于发送get请求和post请求。另外还包含了一些对返回结果的处理，以及一些getter方法，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">public class HttpRequest &#123;</span><br><span class="line">    String content = null;</span><br><span class="line">    URL requestUrl;</span><br><span class="line">    HttpsURLConnection connection;</span><br><span class="line">    int responseCode;</span><br><span class="line">    JSONObject responseBody;</span><br><span class="line">    PrintWriter out = null;</span><br><span class="line"></span><br><span class="line">    public void sendGetRequest(String url,  List&lt;NameValuePair&gt; params, Map&lt;String, String&gt; header) throws IOException &#123;</span><br><span class="line">        //处理请求的参数，参数就是在url后面加上？key1=value1&amp;key2=value2</span><br><span class="line">        url = url + TurnListToString.turnKeysToString(params);</span><br><span class="line">        requestUrl = new URL(url);</span><br><span class="line">        connection = (HttpsURLConnection) requestUrl.openConnection();</span><br><span class="line">        // 默认是 GET方式</span><br><span class="line">        //设置本次连接是否自动重定向</span><br><span class="line">        connection.setInstanceFollowRedirects(true);</span><br><span class="line">        //用自己写的工具类，去设置请求header</span><br><span class="line">        RequestHeader.setRequestHeader(connection);</span><br><span class="line">        //再添加额外的header</span><br><span class="line">        RequestHeader.addExtraHeader(connection, header);</span><br><span class="line"></span><br><span class="line">        // 连接，从postUrl.openConnection()至此的配置必须要在connect之前完成</span><br><span class="line">        connection.connect();</span><br><span class="line">        InputStream inputStream = getInputStream();</span><br><span class="line"></span><br><span class="line">        if (null == inputStream) &#123;</span><br><span class="line">            inputStream = connection.getInputStream();</span><br><span class="line">        &#125;</span><br><span class="line">        readResponseContent(inputStream);</span><br><span class="line">        connection.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sendPostRequest(String url, String body, Map&lt;String, String&gt; header) throws IOException  &#123;</span><br><span class="line">        requestUrl = new URL(url);</span><br><span class="line">        connection = (HttpsURLConnection) requestUrl.openConnection(); </span><br><span class="line">        // 设置是否向connection输出，因为这个是post请求，参数要放在http正文内，因此需要设为true</span><br><span class="line">        connection.setDoOutput(true);</span><br><span class="line">        // Read from the connection. Default is true.</span><br><span class="line">        connection.setDoInput(true);</span><br><span class="line">        // 默认是 GET方式</span><br><span class="line">        connection.setRequestMethod(&quot;POST&quot;);      </span><br><span class="line">        // Post 请求不能使用缓存</span><br><span class="line">        connection.setUseCaches(false);  </span><br><span class="line">        //设置本次连接是否自动重定向 </span><br><span class="line">        connection.setInstanceFollowRedirects(true);      </span><br><span class="line"></span><br><span class="line">        //用自己写的工具类，去设置请求header</span><br><span class="line">        RequestHeader.setRequestHeader(connection);</span><br><span class="line">        //再添加额外的header</span><br><span class="line">        RequestHeader.addExtraHeader(connection, header);</span><br><span class="line"></span><br><span class="line">        out = new PrintWriter(connection.getOutputStream());   </span><br><span class="line">        out.print(body);</span><br><span class="line">        out.flush();</span><br><span class="line"></span><br><span class="line">        // 连接，从postUrl.openConnection()至此的配置必须要在connect之前完成，</span><br><span class="line">        // 要注意的是connection.getOutputStream会隐含的进行connect。</span><br><span class="line">        connection.connect();</span><br><span class="line">        InputStream inputStream = getInputStream();</span><br><span class="line"></span><br><span class="line">        //如果返回的状态码不是200，需要从ErrorStream里读返回数据</span><br><span class="line">        if (null == inputStream) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                inputStream = connection.getInputStream();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                inputStream = connection.getErrorStream();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        readResponseContent(inputStream);</span><br><span class="line">        connection.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void readResponseContent(InputStream inputStream) throws IOException &#123;</span><br><span class="line">        StringBuilder builder = new StringBuilder();</span><br><span class="line">        String line = null;</span><br><span class="line">        BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream, &quot;utf-8&quot;));</span><br><span class="line">        while ((line = reader.readLine()) != null) &#123;</span><br><span class="line">            builder.append(line).append(&quot;\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        content = builder.toString();</span><br><span class="line">        responseBody = (JSONObject) JSON.parse(content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public InputStream getInputStream() throws IOException &#123;</span><br><span class="line">        InputStream inputStream = null;</span><br><span class="line">        if (!TextUtils.isEmpty(connection.getContentEncoding())) &#123;</span><br><span class="line">            String encode = connection.getContentEncoding().toLowerCase();</span><br><span class="line">            if (!TextUtils.isEmpty(encode) &amp;&amp; encode.indexOf(&quot;gzip&quot;) &gt;= 0) &#123;</span><br><span class="line">                inputStream = new GZIPInputStream(connection.getInputStream());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return inputStream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public JSONObject getResponseBody() &#123;</span><br><span class="line">        return responseBody;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //传入valueLength是为了防止第一层没有找到key的时候，可以方便从字符串中找到value的值</span><br><span class="line">    public String getStringFromResponseJSON(String key, int valueLength) &#123;</span><br><span class="line">        String value = responseBody.getString(key);</span><br><span class="line">        //如果第一层没有找到key，那么就把responseBody转成String，看看是否包含key，这个方法有点笨，暂时没想到更好的</span><br><span class="line">        if (TextUtils.isEmpty(value)) &#123;</span><br><span class="line">            if (content.contains(key)) &#123;</span><br><span class="line">                int beginIndex = content.indexOf(key) + key.length() + 2;</span><br><span class="line">                int endIndex = 0;</span><br><span class="line">                Character valueBeginLetter = content.charAt(beginIndex) ;</span><br><span class="line">                //如果包含可以，就取出value，一般json字符串的格式是&quot;key&quot;:&quot;value&quot;</span><br><span class="line">                //如果value是布尔型或者整型就没有引号</span><br><span class="line">                if (valueBeginLetter.toString().equals(&quot;\&quot;&quot;)) &#123;</span><br><span class="line">                    //如果是引号的话从下一个位置开始找</span><br><span class="line">                    beginIndex ++;</span><br><span class="line">                    endIndex = beginIndex + valueLength;</span><br><span class="line">                &#125;</span><br><span class="line">                value = content.substring(beginIndex, endIndex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getResponseCode() throws IOException &#123;</span><br><span class="line">        responseCode = connection.getResponseCode();</span><br><span class="line">        return responseCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getHeaderString(String headerKey) &#123;</span><br><span class="line">        String headerValue = connection.getHeaderField(headerKey);</span><br><span class="line">        return headerValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getStringFromResponseJSON(String key) &#123;</span><br><span class="line">        return responseBody.getString(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="test-com-testdata包"><a href="#test-com-testdata包" class="headerlink" title="test.com.testdata包"></a>test.com.testdata包</h5><p>包里有一个TestData类，抽象出了一条测试用例，话不多说，来看代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* TestData类储存的是一条具体的测试用例，构造函数中处理了从Excel表格中读出来的数据</span><br><span class="line">* @author lulian</span><br><span class="line">* address 请求地址</span><br><span class="line">* checkpoint 检查点</span><br><span class="line">* checkValue 检查值</span><br><span class="line">* body 请求body或者params，GET请求时用作params，POST时用作BODY，但在testdata类里面都是List&lt;NameValuePair&gt;类型储存的</span><br><span class="line">* codeExpected 期待的状态码</span><br><span class="line">* testDescription 用例描述，用来写在报告里面的</span><br><span class="line">* requestMethod 请求的方法</span><br><span class="line">* enabled 表示用例是否要被执行</span><br><span class="line">*/</span><br><span class="line">public class TestData &#123;</span><br><span class="line">    private String address;</span><br><span class="line">    private List&lt;NameValuePair&gt; body;</span><br><span class="line">    private List&lt;NameValuePair&gt; checkPoints;</span><br><span class="line">    private int codeExpected;</span><br><span class="line">    private String testDescription;</span><br><span class="line">    private String requestMethod;</span><br><span class="line">    private boolean enabled;</span><br><span class="line"></span><br><span class="line">    public TestData(int caseLine, Object[][] excelData) &#123;</span><br><span class="line">        //根据列的名字找到列的序号，然后再获取对应的值</span><br><span class="line">        address = excelData[caseLine][ColNumber.getColNumber(&quot;Address&quot;, excelData)].toString().trim();</span><br><span class="line">        String codeContentFromExcel = excelData[caseLine][ColNumber.getColNumber(&quot;code&quot;, excelData)].toString().trim();</span><br><span class="line">        codeExpected = Integer.parseInt(codeContentFromExcel);</span><br><span class="line">        testDescription = excelData[caseLine][ColNumber.getColNumber(&quot;description&quot;, excelData)].toString().trim();</span><br><span class="line">        requestMethod = excelData[caseLine][ColNumber.getColNumber(&quot;requestMethod&quot;, excelData)].toString().trim();</span><br><span class="line">        enabled = excelData[caseLine][ColNumber.getColNumber(&quot;enabled&quot;, excelData)].toString().toString().trim().equals(&quot;1&quot;) ? true : false;</span><br><span class="line">        //用NameValuePair存储所有请求参数</span><br><span class="line">        body = new ArrayList&lt;NameValuePair&gt;();</span><br><span class="line">        for (int j = ColNumber.getColNumber(&quot;Key1&quot;, excelData); j &lt; excelData[caseLine].length - 1; j = j + 2)&#123;</span><br><span class="line">            excelData[caseLine].length);</span><br><span class="line">            //因为每种请求的参数个数不确定，在这里进行非空判断</span><br><span class="line">            if(excelData[caseLine][j].equals(&quot;&quot;))&#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            NameValuePair pair = new BasicNameValuePair(excelData[caseLine][j].toString(),excelData[caseLine][j+1].toString());</span><br><span class="line">            body.add(pair);   </span><br><span class="line">        &#125;</span><br><span class="line">        checkPoints = new ArrayList&lt;NameValuePair&gt;();</span><br><span class="line">        //checkPoint的数量从CheckPoint1开始一直到Key1之前2个</span><br><span class="line">        for (int j = ColNumber.getColNumber(&quot;CheckPoint1&quot;, excelData); j &lt; ColNumber.getColNumber(&quot;Key1&quot;, excelData); j = j + 2) &#123;</span><br><span class="line">            if(excelData[caseLine][j].equals(&quot;&quot;))&#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            NameValuePair pair = new BasicNameValuePair(excelData[caseLine][j].toString(), excelData[caseLine][j+1].toString());</span><br><span class="line">            checkPoints.add(pair);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;NameValuePair&gt; getCheckPoints() &#123;</span><br><span class="line">        return checkPoints;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;NameValuePair&gt; getKeys() &#123;</span><br><span class="line">        return body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getCodeExpected() &#123;</span><br><span class="line">        return codeExpected;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTestDescription() &#123;</span><br><span class="line">        return testDescription; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getRequestMethod() &#123;</span><br><span class="line">        return requestMethod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isEnabled() &#123;</span><br><span class="line">        return enabled;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="test-com-utils包"><a href="#test-com-utils包" class="headerlink" title="test.com.utils包"></a>test.com.utils包</h5><p>这个包里我写了很多工具类，就不一一列出代码了，挑一些个别的，比如从excel中读数据的类ExcelProcess：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class ExcelProcess &#123;</span><br><span class="line">    public static Object[][] processExcel(String filePath) throws IOException, JXLException&#123;</span><br><span class="line">    //数据流读入excel</span><br><span class="line">    File file = new File(System.getProperty(&quot;user.dir&quot;) + filePath);</span><br><span class="line">    Workbook wb = Workbook.getWorkbook(file);</span><br><span class="line">    //读取特定表单，计算行数、列数</span><br><span class="line">    Sheet sheet = wb.getSheet(&quot;case&quot;);</span><br><span class="line">    int numberOfRow = sheet.getRows();</span><br><span class="line">    int numberOfCell = sheet.getColumns();</span><br><span class="line">    //将表单数据存入dtt对象</span><br><span class="line">    Object[][] data = new Object[numberOfRow][numberOfCell];</span><br><span class="line">    for (int i = 0; i &lt; numberOfRow; i++) &#123;</span><br><span class="line">        if (sheet.getCell(0, i).getContents().isEmpty() || sheet.getCell(0, i).getContents().equals(&quot;&quot;)) &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        for (int j = 0; j &lt; numberOfCell; j++) &#123;</span><br><span class="line">            if(sheet.getCell(j, i) == null || sheet.getCell(j, i).equals(&quot;&quot;)) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            Cell cell = sheet.getCell(j, i);</span><br><span class="line">            data[i][j] = cell.getContents();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于jxl库的使用，这里不赘述了，请参考我的另一篇文章<a href="https://lulian666.github.io/2019/07/20/Java-Excel-API——jxl常用类/" target="_blank" rel="noopener">Java Excel API——jxl常用类</a>，里面覆盖到了常用的方法。</p>
<h2 id="5、总结"><a href="#5、总结" class="headerlink" title="5、总结"></a>5、总结</h2><ul>
<li>以上展示的是对单接口进的测试，并没有根据实际业务，写一个全链路的接口测试。</li>
<li>有了这个框架，后面再有新的接口测试，只需要往表格中添加数据，不需要改动代码，可扩展性强</li>
<li>后面会考虑放到Jenkins上定时跑，并且将测试报告发到邮箱中</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/接口测试/" rel="tag"># 接口测试</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/04/TestNG/" rel="next" title="TestNG的基本使用">
                <i class="fa fa-chevron-left"></i> TestNG的基本使用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/26/TestNG监听器/" rel="prev" title="TestNG监听器">
                TestNG监听器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80NTg4My8yMjM5NA"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、分析业务接口"><span class="nav-number">1.</span> <span class="nav-text">1、分析业务接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、设计excel表格"><span class="nav-number">2.</span> <span class="nav-text">2、设计excel表格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、添加依赖"><span class="nav-number">3.</span> <span class="nav-text">3、添加依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、工程结构"><span class="nav-number">4.</span> <span class="nav-text">4、工程结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置文件"><span class="nav-number">4.0.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#src-main-java"><span class="nav-number">4.0.2.</span> <span class="nav-text">src/main/java</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#test-com-api包"><span class="nav-number">4.0.2.1.</span> <span class="nav-text">test.com.api包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#test-com-request包"><span class="nav-number">4.0.2.2.</span> <span class="nav-text">test.com.request包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#test-com-testdata包"><span class="nav-number">4.0.2.3.</span> <span class="nav-text">test.com.testdata包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#test-com-utils包"><span class="nav-number">4.0.2.4.</span> <span class="nav-text">test.com.utils包</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#5、总结"><span class="nav-number">5.</span> <span class="nav-text">5、总结</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
